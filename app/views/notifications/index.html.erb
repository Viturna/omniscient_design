<section class="grid-1">
  <% if @notifications.any? %>
    <% 
      # On dÃ©finit la date actuelle selon la TimeZone de l'app (ex: Paris) et non celle du serveur (UTC)
      today_date = Date.current 
      
      # On initialise les groupes
      today_notifs = []
      week_notifs = []
      month_notifs = []
      old_notifs = []

      # On trie en une seule passe propre
      @notifications.each do |n|
        # Important : Convertir la date de la notif dans la TimeZone locale avant de prendre la date
        n_date = n.created_at.in_time_zone.to_date

        if n_date == today_date
          today_notifs << n
        elsif n_date >= 7.days.ago.to_date
          week_notifs << n
        elsif n_date >= 30.days.ago.to_date
          month_notifs << n
        else
          old_notifs << n
        end
      end
    %>
    <%# --- AUJOURD'HUI --- %>
    <% if today_notifs.any? %>
      <h2><%= t('notifications.today') %></h2>
      <div class="notifications">
        <% today_notifs.each do |notification| %>
          <%= render "notifications/notification", notification: notification %>
        <% end %>
      </div>
    <% end %>
    <%# --- 7 JOURS --- %>
    <% if week_notifs.any? %>
      <h2><%= t('notifications.last_7_days') %></h2>
      <div class="notifications">
        <% week_notifs.each do |notification| %>
          <%= render "notifications/notification", notification: notification %>
        <% end %>
      </div>
    <% end %>
    <%# --- 30 JOURS --- %>
    <% if month_notifs.any? %>
      <h2><%= t('notifications.last_30_days') %></h2>
      <div class="notifications">
        <% month_notifs.each do |notification| %>
          <%= render "notifications/notification", notification: notification %>
        <% end %>
      </div>
    <% end %>
    <%# --- ANCIENNES --- %>
    <% if old_notifs.any? %>
      <h2><%= t('notifications.previous') %></h2>
      <div class="notifications">
        <% old_notifs.each do |notification| %>
          <%= render "notifications/notification", notification: notification %>
        <% end %>
      </div>
    <% end %>
  <% else %>
    <p><%= t('notifications.none') %></p>
  <% end %>
</section>