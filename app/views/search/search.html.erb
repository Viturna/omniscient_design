<% content_for :title, "Rechercher des références et des designers - Omniscient Design" %>
<% content_for :description, "La page de recherche permet de trouver efficacement et rapidement la référence que tu cherches. Trie les références par domaine, année ou encore pays !" %>
<section class="top-bar-search">
  <%= form_with url: search_path, method: :get, local: true do |form| %>
    <div class="autocomplete" data-controller="autocomplete" data-autocomplete-url-value="<%= search_autocomplete_path %>">
      <div class="search-wrapper">
        <input type="search"
               data-autocomplete-target="field"
               data-action="input->autocomplete#search"
        class="search-top-bar"
        placeholder="<%= t('search.placeholder') %>"
        autocomplete="off"
        id="workSearch" />
        <button type="button"
                data-autocomplete-target="clearBtn"
                data-action="click->autocomplete#clear"
          class="clear-search" style="display:none;">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12.0019 2.00488C17.5199 2.00488 21.9999 6.48488 21.9999 12.0019C21.9999 17.5199 17.5199 21.9999 12.0019 21.9999C6.48488 21.9999 2.00488 17.5199 2.00488 12.0019C2.00488 6.48488 6.48488 2.00488 12.0019 2.00488ZM12.0019 10.9379L9.28088 8.21588C9.13488 8.06988 8.94188 7.99688 8.74988 7.99688C8.34588 7.99688 7.99988 8.32088 7.99988 8.74588C7.99988 8.93888 8.07288 9.12988 8.21888 9.27688L10.9409 11.9989L8.21288 14.7269C8.06588 14.8739 7.99288 15.0669 7.99288 15.2579C7.99288 15.6849 8.34288 16.0079 8.74388 16.0079C8.93588 16.0079 9.12788 15.9349 9.27388 15.7889L12.0019 13.0609L14.7309 15.7889C14.8769 15.9349 15.0689 16.0079 15.2609 16.0079C15.6619 16.0079 16.0109 15.6849 16.0109 15.2579C16.0109 15.0669 15.9379 14.8739 15.7909 14.7269L13.0639 11.9989L15.7809 9.28188C15.9269 9.13488 15.9999 8.94388 15.9999 8.75088C15.9999 8.32588 15.6539 8.00088 15.2499 8.00088C15.0579 8.00088 14.8649 8.07388 14.7189 8.22088L12.0019 10.9379Z" fill="#202020"/>
          </svg>
        </button>
      </div>
      <div class="suggestions-box" data-autocomplete-target="results" id="autocompleteResults"></div>
    </div>
  <% end %>
  <div class="top-bar-flex" data-controller="popup">
    <div class="circle circle-notif" data-action="click->popup#open" style="cursor: pointer;">
      <svg width="4" height="22" viewBox="0 0 4 22" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M2 8L2 20" stroke="white" stroke-width="2.82843" stroke-linecap="round"/>
        <path d="M2 2V2.0001" stroke="white" stroke-width="2.82843" stroke-linecap="round"/>
      </svg>
    </div>
    <div class="popup" data-popup-target="modal" data-action="click->popup#backgroundClick" style="display: none;">
      <div class="popup-content">
        <div class="top-popup">
          <svg class="close-popup" data-action="click->popup#close" width="34" height="34" viewBox="0 0 34 34" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M19.9941 16.9964L33.3719 3.63981C33.7717 3.23995 33.9964 2.69763 33.9964 2.13215C33.9964 1.56667 33.7717 1.02435 33.3719 0.624492C32.972 0.224637 32.4297 0 31.8642 0C31.2987 0 30.7564 0.224637 30.3566 0.624492L17 14.0023L3.64343 0.624492C3.24358 0.224637 2.70125 5.02059e-07 2.13577 5.06273e-07C1.57029 5.10486e-07 1.02797 0.224637 0.628116 0.624492C0.228261 1.02435 0.00362441 1.56667 0.00362441 2.13215C0.0036244 2.69763 0.228261 3.23995 0.628116 3.63981L14.0059 16.9964L0.628116 30.3529C0.429087 30.5504 0.271115 30.7852 0.163309 31.044C0.055504 31.3027 0 31.5803 0 31.8606C0 32.1409 0.055504 32.4185 0.163309 32.6772C0.271115 32.936 0.429087 33.1709 0.628116 33.3683C0.825519 33.5673 1.06038 33.7253 1.31914 33.8331C1.5779 33.9409 1.85545 33.9964 2.13577 33.9964C2.4161 33.9964 2.69364 33.9409 2.95241 33.8331C3.21117 33.7253 3.44603 33.5673 3.64343 33.3683L17 19.9905L30.3566 33.3683C30.554 33.5673 30.7888 33.7253 31.0476 33.8331C31.3064 33.9409 31.5839 33.9964 31.8642 33.9964C32.1445 33.9964 32.4221 33.9409 32.6809 33.8331C32.9396 33.7253 33.1745 33.5673 33.3719 33.3683C33.5709 33.1709 33.7289 32.936 33.8367 32.6772C33.9445 32.4185 34 32.1409 34 31.8606C34 31.5803 33.9445 31.3027 33.8367 31.044C33.7289 30.7852 33.5709 30.5504 33.3719 30.3529L19.9941 16.9964Z" fill="#202020"/>
          </svg>
        </div>
        <div class="popup-inner">
          <div class="popup-decoration">
            <%= image_tag("logo-white.svg", :alt => "logo omniscient design") %>
          </div>
          <p class="subtitle-popup"><%= t('mainpopup.subtitle_project') %></p>
          <p><%= t('mainpopup.description_project').gsub("\n", "<br>").html_safe %></p>
          <%= link_to presentation_url, class: "button dark" do %>
            <%= t('mainpopup.button_project') %>
          <%end%>
          <div class="popup-decoration">
            <svg width="186" height="46" viewBox="0 0 186 46" fill="none" xmlns="http://www.w3.org/2000/svg">
              <g clip-path="url(#clip0_3317_340)">
                <path d="M23 0L30.0303 15.6304L46 17.8365L34.3773 29.0068L37.214 46L23 37.2715L8.78408 46L11.6227 29.0068L0 17.8365L15.9697 15.6304L23 0Z" fill="white"/>
              </g>
              <g clip-path="url(#clip1_3317_340)">
                <path d="M93 0L100.03 15.6304L116 17.8365L104.377 29.0068L107.214 46L93 37.2715L78.7841 46L81.6227 29.0068L70 17.8365L85.9697 15.6304L93 0Z" fill="white"/>
              </g>
              <g clip-path="url(#clip2_3317_340)">
                <path d="M163 0L170.03 15.6304L186 17.8365L174.377 29.0068L177.214 46L163 37.2715L148.784 46L151.623 29.0068L140 17.8365L155.97 15.6304L163 0Z" fill="white"/>
              </g>
              <defs>
                <clipPath id="clip0_3317_340">
                  <rect width="46" height="46" fill="white"/>
                </clipPath>
                <clipPath id="clip1_3317_340">
                  <rect width="46" height="46" fill="white" transform="translate(70)"/>
                </clipPath>
                <clipPath id="clip2_3317_340">
                  <rect width="46" height="46" fill="white" transform="translate(140)"/>
                </clipPath>
              </defs>
            </svg>
          </div>
          <p class="subtitle-popup"><%= t('mainpopup.subtitle_feedback') %></p>
          <p><%= t('mainpopup.description_feedback') %></p>
          <%= link_to new_feedback_url, class: "button dark" do %>
            <%= t('mainpopup.button_feedback') %>
          <%end%>
        </div>
      </div>
    </div>
    <%= link_to notifications_path do %>
      <div class="circle circle-notif">
        <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M20.1825 5.26C19.3238 4.76133 18.7932 3.83333 18.7945 2.83333V2.82933C18.7958 1.26667 17.5438 0 15.9998 0C14.4558 0 13.2038 1.26667 13.2038 2.82933V2.83333C13.2052 3.83467 12.6758 4.76133 11.8158 5.26C5.59317 8.876 9.16917 20.88 2.6665 23.0013V25.3333H29.3332V23.0013C22.8305 20.88 26.4065 8.876 20.1825 5.26ZM15.9998 1.33333C16.7358 1.33333 17.3332 1.932 17.3332 2.66667C17.3332 3.40267 16.7358 4 15.9998 4C15.2638 4 14.6665 3.40267 14.6665 2.66667C14.6665 1.932 15.2638 1.33333 15.9998 1.33333ZM19.9998 28C19.9998 30.1307 18.1438 32 16.0385 32C13.9332 32 11.9998 30.1307 11.9998 28H19.9998Z" fill="white"/>
        </svg>
        <% if current_user && @unread_notifications_count.to_i > 0 %>
          <div class="notification-counter">
            <div class="notification-badge"><%= @unread_notifications_count %></div>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>
</section>
<section class="grid-1 searchpage" 
         data-controller="tabs-search"
         data-tabs-search-sort-data-value='{
            "designers": {
              "nom_asc": "<%= t("search.name_asc") %>",
              "nom_desc": "<%= t("search.name_desc") %>",
              "naissance_asc": "<%= t("search.birth_old_new") %>",
              "naissance_desc": "<%= t("search.birth_new_old") %>"
            },
            "references": {
              "nom_asc": "<%= t("search.name_asc") %>",
              "nom_desc": "<%= t("search.name_desc") %>",
              "oeuvre_asc": "<%= t("search.oeuvre_old_new") %>",
              "oeuvre_desc": "<%= t("search.oeuvre_new_old") %>"
            }
         }'>
  <h1><%= t('search.title') %></h1>
  <div class="tabs">
    <button class="tab <%= 'active' if params[:tab].blank? || params[:tab] == 'references' %>" 
            data-tab="references" 
            data-tabs-search-target="tab" 
            data-action="click->tabs-search#switch">
      <%= t('global.references') %> (<%= Oeuvre.where(validation: true).count %>)
    </button>
    <button class="tab <%= 'active' if params[:tab] == 'designers' %>" 
            data-tab="designers" 
            data-tabs-search-target="tab" 
            data-action="click->tabs-search#switch">
      <%= t('global.designers') %> (<%= Designer.where(validation: true).count %>)
    </button>
    <button class="tab <%= 'active' if params[:tab] == 'studios' %>" 
          data-tab="studios" 
          data-tabs-search-target="tab" 
          data-action="click->tabs-search#switch">
      <%= t('global.studios', default: 'Studios') %> (<%= Studio.where(validation: true).count %>)
    </button>
    <button class="tab <%= 'active' if params[:tab] == 'frise' %>" 
            data-tab="frise" 
            data-tabs-search-target="tab" 
            data-action="click->tabs-search#switch">
      <%= t('search.timeline') %>
    </button>
  </div>
  <%= form_with url: search_path, method: :get, local: true, id: "filterForm", data: { turbo: false } do |form| %>
    <%= form.hidden_field :tab, id: "activeTab", value: params[:tab] || "references", data: { tabs_search_target: "tabInput" } %>
    <h2><%= t('search.filters') %></h2>
    <div class="filters">
      <div class="filter" data-tabs-search-target="domainFilter">
        <label for="domainFilter"><%= t('search.domain') %></label>
        <%= form.select :domaine, 
              Domaine.all.map { |d| [d.domaine, d.id] }, 
              { include_blank: false, selected: params[:domaine] }, 
              { 
                multiple: true, 
                class: "form-control",
                data: {
                  controller: "select2",
                  select2_placeholder_value: t('search.domain'),
                  action: "change->tabs-search#update"
                }
              } %>
      </div>
      <div class="filter" data-tabs-search-target="notionsFilter" data-controller="mega-menu">
        <label><%= t('search.notions') %></label>
        <button type="button" class="mega-menu-btn" data-mega-menu-target="button" data-action="click->mega-menu#toggle">
          <span data-mega-menu-target="label"><%= t('search.choose_notions') %></span>
          <svg width="12" height="8" viewBox="0 0 12 8" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M1 1.5L6 6.5L11 1.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <div class="mega-menu-content" data-mega-menu-target="content">
          <div class="mega-menu-themes-view" data-mega-menu-target="themesView">
            <div class="theme-cards-grid">
              <% Notion.unique_themes.each do |theme| %>
                <div class="theme-card" data-action="click->mega-menu#selectTheme" data-theme-name="<%= theme %>">
                  <span class="theme-card-title"><%= theme %></span>
                  <div class="arrow-theme-card">
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M16 3C13.4288 3 10.9154 3.76244 8.77759 5.1909C6.63975 6.61935 4.97351 8.64968 3.98957 11.0251C3.00563 13.4006 2.74819 16.0144 3.2498 18.5362C3.75141 21.0579 4.98953 23.3743 6.80762 25.1924C8.6257 27.0105 10.9421 28.2486 13.4638 28.7502C15.9856 29.2518 18.5995 28.9944 20.9749 28.0104C23.3503 27.0265 25.3807 25.3603 26.8091 23.2224C28.2376 21.0846 29 18.5712 29 16C28.9964 12.5533 27.6256 9.24882 25.1884 6.81163C22.7512 4.37445 19.4467 3.00364 16 3ZM16 27C13.8244 27 11.6977 26.3549 9.88873 25.1462C8.07979 23.9375 6.66989 22.2195 5.83733 20.2095C5.00477 18.1995 4.78693 15.9878 5.21137 13.854C5.63581 11.7202 6.68345 9.7602 8.22183 8.22183C9.76021 6.68345 11.7202 5.6358 13.854 5.21136C15.9878 4.78692 18.1995 5.00476 20.2095 5.83733C22.2195 6.66989 23.9375 8.07979 25.1462 9.88873C26.3549 11.6977 27 13.8244 27 16C26.9967 18.9164 25.8367 21.7123 23.7745 23.7745C21.7123 25.8367 18.9164 26.9967 16 27ZM21.7075 15.2925C21.8005 15.3854 21.8742 15.4957 21.9246 15.6171C21.9749 15.7385 22.0008 15.8686 22.0008 16C22.0008 16.1314 21.9749 16.2615 21.9246 16.3829C21.8742 16.5043 21.8005 16.6146 21.7075 16.7075L17.7075 20.7075C17.5199 20.8951 17.2654 21.0006 17 21.0006C16.7346 21.0006 16.4801 20.8951 16.2925 20.7075C16.1049 20.5199 15.9994 20.2654 15.9994 20C15.9994 19.7346 16.1049 19.4801 16.2925 19.2925L18.5863 17H11C10.7348 17 10.4804 16.8946 10.2929 16.7071C10.1054 16.5196 10 16.2652 10 16C10 15.7348 10.1054 15.4804 10.2929 15.2929C10.4804 15.1054 10.7348 15 11 15H18.5863L16.2925 12.7075C16.1049 12.5199 15.9994 12.2654 15.9994 12C15.9994 11.7346 16.1049 11.4801 16.2925 11.2925C16.4801 11.1049 16.7346 10.9994 17 10.9994C17.2654 10.9994 17.5199 11.1049 17.7075 11.2925L21.7075 15.2925Z" fill="#202020"/>
                    </svg>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
          <div class="mega-menu-notions-view" data-mega-menu-target="notionsView" style="display: none;">
            <div class="mega-menu-header">
              <button type="button" class="mega-menu-back-btn" data-action="click->mega-menu#backToThemes">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-right: 8px; vertical-align: middle;">
                  <path d="M19 12H5M5 12L12 19M5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Retour
              </button>
              <h4 class="mega-menu-selected-theme-title" data-mega-menu-target="selectedThemeTitle"></h4>
            </div>
            <div class="mega-menu-grid">
              <% Notion.unique_themes.each do |theme| %>
                <div class="mega-menu-column" data-mega-menu-target="themeColumn" data-theme-name="<%= theme %>" style="display: none;">
                  <% Notion.by_theme(theme).ordered.each do |notion| %>
                    <div class="mega-menu-group">
                      <div class="mega-menu-subtitle" data-action="click->mega-menu#toggleAccordion">
                        <span><%= notion.name %></span>
                        <svg class="chevron-icon" width="10" height="6" viewBox="0 0 10 6" fill="none" style="transition: transform 0.2s ease;">
                          <path d="M1 1L5 5L9 1" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </div>
                      <% has_checked_item = notion.verbs.any? { |v| params[:notions]&.include?(v.id.to_s) } %>
                      <div class="mega-menu-items <%= 'open' if has_checked_item %>">
                        <% notion.verbs.each do |verb| %>
                          <label class="mega-menu-item">
                            <input type="checkbox" 
                           name="notions[]" 
                           value="<%= verb.id %>" 
                           <%= "checked" if params[:notions]&.include?(verb.id.to_s) %>
                           data-action="change->tabs-search#update change->mega-menu#updateLabel">
                            <span><%= verb.name %></span>
                          </label>
                        <% end %>
                      </div>
                    </div>
                  <% end %>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      </div>
      <div class="filter" data-tabs-search-target="countryFilter">
        <label for="paysFilter"><%= t('search.country') %></label>
        <%= form.select :country, 
              @countries.all.map { |p| [p.country, p.id] }, 
              { include_blank: t('search.choose_country'), selected: params[:country] }, 
              { 
                multiple: true, 
                class: "form-control",
                data: {
                  controller: "select2",
                  select2_placeholder_value: t('search.choose_country'),
                  action: "change->tabs-search#update"
                }
              } %>
      </div>
      <div class="filter" data-controller="dropdown" data-tabs-search-target="dateFilter">
        <label for="dateFilter"><%= t('search.dates') %></label>
        <div class="dropdown">
          <button type="button" class="dropdown-toggle" data-dropdown-target="toggle">
            <%= t('search.select_period') %>
          </button>
          <div class="dropdown-menu" data-dropdown-target="menu">
            <div>
              <label for="startDate"><%= t('search.from') %></label>
              <%= form.number_field :start_year,
                value: params[:start_year],
                class: "date-filter",
                id: "startDate",
                placeholder: t('search.start_year') %>
            </div>
            <div>
              <label for="endDate"><%= t('search.to') %></label>
              <%= form.number_field :end_year,
                value: params[:end_year],
                class: "date-filter",
                id: "endDate",
                placeholder: t('search.end_year') %>
            </div>
            <button type="button" 
              id="applyDateFilter" 
              class="button dark"
              data-action="click->tabs-search#update">
              <%= t('search.apply') %>
            </button>
          </div>
        </div>
      </div>
      <div class="filter" id="sortFilterContainer" data-tabs-search-target="sortFilter">
        <label for="sort"><%= t('search.sort_by') %></label>
        <select name="sort" 
                id="sortSelect" 
                class="form-control" 
                data-tabs-search-target="sortSelect"
                data-controller="select2"
                data-action="change->tabs-search#update"
          data-select2-minimum-results-for-search-value="Infinity">
          <% if params[:tab] == 'references' %>
            <option value="nom_asc" <%= 'selected' if params[:sort] == 'nom_asc' %>><%= t('search.name_asc') %></option>
              <option value="nom_desc" <%= 'selected' if params[:sort] == 'nom_desc' %>><%= t('search.name_desc') %></option>
                <option value="oeuvre_asc" <%= 'selected' if params[:sort] == 'oeuvre_asc' %>><%= t('search.oeuvre_old_new') %></option>
                  <option value="oeuvre_desc" <%= 'selected' if params[:sort] == 'oeuvre_desc' %>><%= t('search.oeuvre_new_old') %></option>
                  <% else %>
                    <option value="nom_asc" <%= 'selected' if params[:sort] == 'nom_asc' %>><%= t('search.name_asc') %></option>
                      <option value="nom_desc" <%= 'selected' if params[:sort] == 'nom_desc' %>><%= t('search.name_desc') %></option>
                        <option value="naissance_asc" <%= 'selected' if params[:sort] == 'naissance_asc' %>><%= t('search.birth_old_new') %></option>
                          <option value="naissance_desc" <%= 'selected' if params[:sort] == 'naissance_desc' %>><%= t('search.birth_new_old') %></option>
                          <% end %>
                        </select>
                      </div>
                    </div>
                  <% end %>
                  <div id="references" class="content-tab" data-tabs-search-target="tabContent" style="<%= params[:tab].blank? || params[:tab] == 'references' ? 'display:block;' : 'display:none;' %>">
                    <div id="oeuvres-container" class="flex-container">
                      <% @oeuvres.each do |oeuvre| %>
                        <%= render 'oeuvres/oeuvre_card', oeuvre: oeuvre %>
                      <% end %>
                    </div>
                    <% unless params[:tab] == "frise" %>
                      <%= paginate @oeuvres, params: { tab: 'references' }, window: 1, outer_window: 1 %>
                    <% end %>
                  </div>
                  <div id="studios" class="content-tab" data-tabs-search-target="tabContent" style="<%= params[:tab] == 'studios' ? 'display:block;' : 'display:none;' %>">
                    <div id="studios-container" class="flex-container">
                      <% @studios.each do |studio| %>
                        <%= render 'studios/studio_card', studio: studio %>
                      <% end %>
                    </div>
                    <% unless params[:tab] == "frise" %>
                      <%= paginate @studios, params: { tab: 'studios' }, window: 1, outer_window: 1 %>
                    <% end %>
                  </div>
                  <div id="designers" class="content-tab" data-tabs-search-target="tabContent" style="<%= params[:tab] == 'designers' ? 'display:block;' : 'display:none;' %>">
                    <div id="designers-container" class="flex-container">
                      <% @designers.each do |designer| %>
                        <%= render 'designers/designer_card', designer: designer %>
                      <% end %>
                    </div>
                    <% unless params[:tab] == "frise" %>
                      <%= paginate @designers, params: { tab: 'designers' }, window: 1, outer_window: 1 %>
                    <% end %>
                  </div>
                  <div id="frise" class="content-tab" data-tabs-search-target="tabContent" style="<%= params[:tab] == 'frise' ? 'display:block;' : 'display:none;' %>">
                    <h2><%= t('global.references') %></h2>
                    <div class="timeline" data-tabs-search-target="timeline" data-controller="timeline">
                      <% @timeline_years.each do |year| %>
                        <div class="timeline-item">
                          <div class="oeuvres">
                            <div class="oeuvres-container">
                              <% oeuvres_year = @oeuvres.select { |o| o.date_oeuvre.to_i == year } %>
                              <% if oeuvres_year.size > 1 %>
                                <div class="oeuvres-counter" data-controller="oeuvres-counter">
                                  <span class="circle-with-number" data-action="click->oeuvres-counter#toggle">+<%= oeuvres_year.size %></span>
                                  <div class="hidden-oeuvres" data-oeuvres-counter-target="hiddenOeuvres" style="display: none;">
                                    <% oeuvres_year.each do |oeuvre| %>
                                      <%= link_to oeuvre, class: "oeuvre-point" do %>
                                        <% if oeuvre.oeuvre_images.first&.file&.attached? %>
                                          <div class="oeuvre" title="<%= oeuvre.nom_oeuvre %>" data-year="<%= oeuvre.date_oeuvre %>" style="background-image: url('<%= url_for(oeuvre.oeuvre_images.first.file.variant(:thumb))  %>');"></div>
                                        <% else %>
                                          <div class="oeuvre" title="<%= oeuvre.nom_oeuvre %>" data-year="<%= oeuvre.date_oeuvre %>" style="background-color: #D9D9D9;"></div>
                                        <% end %>
                                      <% end %>
                                    <% end %>
                                  </div>
                                </div>
                              <% else %>
                                <% oeuvres_year.each do |oeuvre| %>
                                  <%= link_to oeuvre, class: "oeuvre-point" do %>
                                    <% if oeuvre.oeuvre_images.first&.file&.attached? %>
                                      <div class="oeuvre" title="<%= oeuvre.nom_oeuvre %>" data-year="<%= oeuvre.date_oeuvre %>" style="background-image: url('<%= url_for(oeuvre.oeuvre_images.first.file.variant(:thumb))  %>');"></div>
                                    <% else %>
                                      <div class="oeuvre" title="<%= oeuvre.nom_oeuvre %>" data-year="<%= oeuvre.date_oeuvre %>" style="background-color: #D9D9D9;"></div>
                                    <% end %>
                                  <% end %>
                                <% end %>
                              <% end %>
                            </div>
                            <div class="oeuvre empty"></div>
                            <div class="year"><%= year %></div>
                          </div>
                        </div>
                      <% end %>
                    </div>
                    <h2><%= t('global.designers') %></h2>
                    <div class="timeline"  data-tabs-search-target="timeline" data-controller="timeline">
                      <% @timeline_years.each do |year| %>
                        <div class="timeline-item">
                          <div class="oeuvres">
                            <div class="oeuvres-container">
                              <% designers_year = @designers.select { |d| d.date_naissance.to_i == year } %>
                              <% if designers_year.size > 1 %>
                                <div class="oeuvres-counter" data-controller="oeuvres-counter">
                                  <span class="circle-with-number" data-action="click->oeuvres-counter#toggle">+<%= designers_year.size %></span>
                                  <div class="hidden-oeuvres" data-oeuvres-counter-target="hiddenOeuvres" style="display: none;">
                                    <% designers_year.each do |designer| %>
                                      <%= link_to designer, class: "oeuvre-point" do %>
                                        <% if designer.designer_images.first&.file&.attached? %>
                                          <div class="oeuvre" title="<%= designer.nom_designer %>" data-year="<%= designer.date_naissance %>" style="background-image: url('<%= url_for(designer.designer_images.first.file.variant(:thumb))  %>');"></div>
                                        <% else %>
                                          <div class="oeuvre" title="<%= designer.nom_designer %>" data-year="<%= designer.date_naissance %>" style="background-color: #D9D9D9;"></div>
                                        <% end %>
                                      <% end %>
                                    <% end %>
                                  </div>
                                </div>
                              <% else %>
                                <% designers_year.each do |designer| %>
                                  <%= link_to designer, class: "oeuvre-point" do %>
                                    <% if designer.designer_images.first&.file&.attached? %>
                                      <div class="oeuvre" title="<%= designer.nom_designer %>" data-year="<%= designer.date_naissance %>" style="background-image: url('<%= url_for(designer.designer_images.first.file.variant(:thumb))  %>');"></div>
                                    <% else %>
                                      <div class="oeuvre" title="<%= designer.nom_designer %>" data-year="<%= designer.date_naissance %>" style="background-color: #D9D9D9;"></div>
                                    <% end %>
                                  <% end %>
                                <% end %>
                              <% end %>
                            </div>
                            <div class="oeuvre empty"></div>
                            <div class="year"><%= year %></div>
                          </div>
                        </div>
                      <% end %>
                    </div>
                    <h2>Studios</h2>
                    <div class="timeline"  data-tabs-search-target="timeline" data-controller="timeline">
                      <% @timeline_years.each do |year| %>
                        <div class="timeline-item">
                          <div class="oeuvres">
                            <div class="oeuvres-container">
                              <% studios_year = @studios.select { |d| d.date_creation.to_i == year } %>
                              <% if studios_year.size > 1 %>
                                <div class="oeuvres-counter" data-controller="oeuvres-counter">
                                  <span class="circle-with-number" data-action="click->oeuvres-counter#toggle">+<%= studios_year.size %></span>
                                  <div class="hidden-oeuvres" data-oeuvres-counter-target="hiddenOeuvres" style="display: none;">
                                    <% studios_year.each do |studio| %>
                                      <%= link_to studio, class: "oeuvre-point" do %>
                                        <% if studio.studio_images.first&.file&.attached? %>
                                          <div class="oeuvre" title="<%= studio.nom %>" data-year="<%= studio.date_creation %>" style="background-image: url('<%= url_for(studio.studio_images.first.file.variant(:thumb))  %>');"></div>
                                        <% else %>
                                          <div class="oeuvre" title="<%= studio.nom %>" data-year="<%= studio.date_creation %>" style="background-color: #D9D9D9;"></div>
                                        <% end %>
                                      <% end %>
                                    <% end %>
                                  </div>
                                </div>
                              <% else %>
                                <% studios_year.each do |studio| %>
                                  <%= link_to studio, class: "oeuvre-point" do %>
                                    <% if studio.studio_images.first&.file&.attached? %>
                                      <div class="oeuvre" title="<%= studio.nom %>" data-year="<%= studio.date_creation %>" style="background-image: url('<%= url_for(studio.studio_images.first.file.variant(:thumb))  %>');"></div>
                                    <% else %>
                                      <div class="oeuvre" title="<%= studio.nom %>" data-year="<%= studio.date_creation %>" style="background-color: #D9D9D9;"></div>
                                    <% end %>
                                  <% end %>
                                <% end %>
                              <% end %>
                            </div>
                            <div class="oeuvre empty"></div>
                            <div class="year"><%= year %></div>
                          </div>
                        </div>
                      <% end %>
                    </div>
                  </div>
                </section>