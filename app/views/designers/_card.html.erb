<%
  # Détermination de l'image
  raw_path = "designers/desktop/#{remove_accents_and_special_chars(card.nom_designer)}.webp"
  image_path = asset_exists?(raw_path) ? asset_path(raw_path) : card.image
%>

<%= link_to designer_path(card.slug) do %>
  <div class="card" data-id="<%= card.id %>">

    <%# --------- Couleur de fond --------- %>
    <% if card.domaines.any? %>
      <% if card.domaines.size == 1 %>
        <!-- Un seul domaine → couleur unie -->
        <div class="bg-card" style="background-color: <%= card.domaines.first.couleur %>;">
      <% else %>
        <!-- Plusieurs domaines → dégradé -->
        <% colors = card.domaines.map(&:couleur).join(', ') %>
        <div class="bg-card" style="background: linear-gradient(45deg, <%= colors %>);">
      <% end %>
    <% else %>
      <!-- Aucun domaine → couleur par défaut -->
      <div class="bg-card" style="background-color: #ccc;">
    <% end %>

      <%# --------- Image de fond --------- %>
      <% if image_path.present? %>
        <div class="bg-img-card"
             style="background-image: url('<%= image_path %>');
                    background-repeat: no-repeat;
                    background-position: center center;
                    background-size: cover;">

          <%# --------- Infos du designer --------- %>
          <div class="flex-info-card">
            <div>
              <div class="info-card-dark">
                <%= card.date_naissance %>
                <% if card.date_deces.present? %>
                  - <%= card.date_deces %>
                <% end %>
              </div>

              <div class="info-card-dark">
                <span class="flag">
                  <%= card.countries.map { |c| country_flag(c.country_numeric) }.join(' ') %>
                </span>
              </div>
            </div>

            <%# --------- Domaines --------- %>
            <% if card.domaines.present? %>
              <div class="domaine-flex-card">
                <% card.domaines.each do |domaine| %>
                  <div class="info-card-dark">
                    <div class="small-circle" style="background-color: <%= domaine.couleur %>;"></div>
                    <%= domaine.domaine %>
                  </div>
                <% end %>
              </div>
            <% else %>
              <div class="info-card-dark">
                Domaine non spécifié
              </div>
            <% end %>
          </div> <!-- fin flex-info-card -->

          <img src="<%= image_path %>"
               alt="<%= card.nom_designer %>"
               class="img-card">
        </div> <!-- fin bg-img-card -->
      <% end %>

    </div> <!-- fin bg-card -->

    <%# --------- Texte en dessous de la carte --------- %>
    <div class="container-text-card">
      <% if card.countries.present? %>
        <p class="subtitle-card">
          <%= card.countries.map(&:name).join(' & ') %>
        </p>
      <% end %>

      <h2 class="title-card"><%= card.nom_designer %></h2>
      <p class="description-card description-card-home"><%= card.presentation_generale %></p>
    </div>

  </div> <!-- fin .card -->
<% end %>
