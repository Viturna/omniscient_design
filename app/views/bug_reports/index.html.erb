<style>
  .status-select {
    margin: 0;
    padding: 0;
    background: none;
    border: none;
    cursor: pointer;
    font-size: 14px;
  }
  form select{
    width: fit-content;
  }
</style>
<section class="top-default-page">
  <%= link_to profil_path do %>
    <svg width="22" height="20" viewBox="0 0 22 20" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M21 10.2168L1.57848 10.2168M1.57848 10.2168L8.86155 18.4336M1.57848 10.2168L8.86155 2" stroke="white" stroke-width="2" stroke-linecap="square"/>
    </svg>
  <% end %>
  <h1>Signalements de bugs</h1>
</section>
<section class="grid-1">
  <h2>À faire</h2>
  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th>Description</th>
          <th>URL</th>
          <th>Signalé par</th>
          <th>Date</th>
          <th>Statut</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% @bug_reports_todo.each do |bug_report| %>
          <tr>
            <td><%= bug_report.description %></td>
            <td><%= bug_report.url %></td>
            <td><%= bug_report.user.email %></td>
            <td><%= l(bug_report.created_at, format: :long) %></td>
            <td>
              <%= form_with url: update_status_bug_report_path(bug_report), method: :patch, local: true, class: "status-form" do %>
                <%= select_tag :status, options_for_select(BugReport::STATUSES, bug_report.status), class: 'status-select', onchange: 'this.form.submit()' %>
              <% end %>
            </td>
            <td>
              <%= link_to 'Voir', bug_report_path(bug_report), class: 'btn' %>
              <%= link_to 'Supprimer', bug_report, method: :delete, data: { confirm: 'Êtes-vous sûr?' }, class: 'btn btn-danger' %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</section>
<section class="grid-1">
  <h2>En cours</h2>
  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th>Description</th>
          <th>URL</th>
          <th>Signalé par</th>
          <th>Date</th>
          <th>Statut</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% @bug_reports_in_progress.each do |bug_report| %>
          <tr>
            <td><%= bug_report.description %></td>
            <td><%= bug_report.url %></td>
            <td><%= bug_report.user.email %></td>
            <td><%= l(bug_report.created_at, format: :long) %></td>
            <td>
              <%= form_with url: update_status_bug_report_path(bug_report), method: :patch, local: true, class: "status-form" do %>
                <%= select_tag :status, options_for_select(BugReport::STATUSES, bug_report.status), class: 'status-select', onchange: 'this.form.submit()' %>
              <% end %>
            </td>
            <td>
              <%= link_to 'Voir', bug_report_path(bug_report), class: 'btn' %>
              <%= link_to 'Supprimer', bug_report, method: :delete, data: { confirm: 'Êtes-vous sûr?' }, class: 'btn btn-danger' %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</section>
<section class="grid-1">
  <h2>Corrigé</h2>
  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th>Description</th>
          <th>URL</th>
          <th>Signalé par</th>
          <th>Date</th>
          <th>Statut</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% @bug_reports_resolved.each do |bug_report| %>
          <tr>
            <td><%= bug_report.description %></td>
            <td><%= bug_report.url %></td>
            <td><%= bug_report.user.email %></td>
            <td><%= l(bug_report.created_at, format: :long) %></td>
            <td>
              <%= form_with url: update_status_bug_report_path(bug_report), method: :patch, local: true, class: "status-form" do %>
                <%= select_tag :status, options_for_select(BugReport::STATUSES, bug_report.status), class: 'status-select', onchange: 'this.form.submit()' %>
              <% end %>
            </td>
            <td>
              <%= link_to 'Voir', bug_report_path(bug_report), class: 'btn' %>
              <%= link_to 'Supprimer', bug_report, method: :delete, data: { confirm: 'Êtes-vous sûr?' }, class: 'btn btn-danger' %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</section>
<section class="grid-1">
  <h2>Tous les reports</h2>
  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th>Description</th>
          <th>URL</th>
          <th>Signalé par</th>
          <th>Date</th>
          <th>Statut</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% @bug_reports_all.each do |bug_report| %>
          <tr>
            <td><%= bug_report.description %></td>
            <td><%= bug_report.url %></td>
            <td><%= bug_report.user.email %></td>
            <td><%= l(bug_report.created_at, format: :long) %></td>
            <td>
              <%= form_with url: update_status_bug_report_path(bug_report), method: :patch, local: true, class: "status-form" do %>
                <%= select_tag :status, options_for_select(BugReport::STATUSES, bug_report.status), class: 'status-select', onchange: 'this.form.submit()' %>
              <% end %>
            </td>
            <td>
              <%= link_to 'Voir', bug_report_path(bug_report), class: 'btn' %>
              <%= link_to 'Supprimer', bug_report, method: :delete, data: { confirm: 'Êtes-vous sûr?' }, class: 'btn btn-danger' %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</section>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Fonction pour afficher plus de lignes pour un tableau spécifique
    function showMoreRows(rows, loadMoreButton) {
      const initialRowsToShow = 10;
      let rowsToShow = initialRowsToShow;

      // Cacher les lignes supplémentaires initialement
      rows.forEach((row, index) => {
        if (index >= rowsToShow) {
          row.style.display = 'none';
        }
      });

      loadMoreButton.addEventListener('click', function () {
        for (let i = rowsToShow; i < rowsToShow + initialRowsToShow; i++) {
          if (i >= rows.length) {
            loadMoreButton.disabled = true;
            loadMoreButton.textContent = "Toutes les lignes chargées";
            break;
          }
          rows[i].style.display = '';
        }
        rowsToShow += initialRowsToShow;
      });
    }

    // Récupérer tous les tableaux et les boutons "Voir plus"
    const tables = document.querySelectorAll('.grid-1 table');
    const loadMoreButtons = document.querySelectorAll('[id^="load-more-button"]');

    // Pour chaque tableau, appliquer la fonction showMoreRows
    tables.forEach((table, index) => {
      const rows = table.querySelectorAll('tbody tr');
      const loadMoreButton = loadMoreButtons[index];
      showMoreRows(rows, loadMoreButton);
    });
  });
</script>
