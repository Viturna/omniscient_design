<% return unless local_assigns.key?(:ad) && ad.present? %>

<%# Récupération de l'ID (adapte selon si ad est un Hash ou un Objet) %>
<% ad_id = ad.is_a?(Hash) ? ad[:id] : ad.id %>

<%# 1. Lien modifié pour pointer vers notre route de tracking "click" %>
<%= link_to click_ad_path(ad_id), target: "_blank", class: "ad-card-link" do %>
  
  <%# 2. Script pour compter l'impression au chargement %>
  <%# Cela appelle la route 'impression' sans bloquer l'affichage %>
  <img src="<%= impression_ad_path(ad_id) %>" style="display:none;" alt="" aria-hidden="true" loading="eager">

  <div class="card ad-card">
     <div class="bg-card" style="background-color: #52525D;">
      <div class="bg-img-card card-slider-wrapper" 
           data-controller="slider" 
           data-slider-update-background-value="true">
        <div class="card-slider-blurred-bg" data-slider-target="background"></div>
        <div class="card-slider-slides">
          <picture>
            <source media="(max-width: 760px)" 
                    srcset="<%= ad[:image_mobile_url] %>">
            <source media="(min-width: 761px)" 
                    srcset="<%= ad[:image_desktop_url] %>">
            <img src="<%= ad[:image_desktop_url] %>" 
                 class="card-slide-image active" 
                 data-slider-target="slide"
                 alt="<%= ad[:title] %>" />
          </picture>
        </div>
        <div class="flex-info-card ads">
          <div class="info-card-dark">
            <div class="small-circle" style="background-color: #FFF;"></div>
            Sponsorisé
          </div>
          <div class="info-card" style="background-color: #FFF; color: #202020;">
            En savoir plus →
          </div>
        </div>
      </div>
    </div>
    <div class="container-text-card">
      <p class="subtitle-card">
        Sponsorisé
      </p>
      <h2 class="title-card"><%= ad[:title] %></h2>
      <p class="description-card description-card-home"><%= ad[:description] %></p>
    </div>
  </div>
<% end %>